# NEA-drug-data-plots

Code for visualization and analysis of intracellular action potentials recorded on a custom multichannel nanoelectrode array. See [this publication](https://doi.org/10.1016/j.bios.2022.114617) for more information. 

Requires [statannot](https://github.com/webermarcolivier/statannot), as well as many of the signal processing libraries in MATLAB (including findpeaks and h5read).

The bulk of the analysis code is written in MATLAB because some of the members in lab prefer to use GUIDE, the GUI editor in MATLAB, and prefer to interact with the data via a graphic user interface (alas, my push for the adoption of ipywidgets in jupyter notebooks for easy visualization has failed). As this is code that has been cobbled together by many people and our lab doesn't really use any form of reasonable version control or have guidelines for code hygiene, it is kind of a mess to read through. The gist of the analysis is that the sharp rising phase of intracellular action potentials can be identified by taking the standard deviation of the signal and it is then possible to perform peak finding on the derivative and use some heuristics to filter and identify the starting, maximum and ending points of each action potential. From there, information such as the APD and t-rise can be determined and computed for each action potential. 

The original MATLAB GUI was intended for analyzing one channel of the multichannel array at a time, since it was easiest to visualize the channels one at a time. However, since the multichannel array generates ~64 channels of data per experiment, this is quite inefficient. While the better solution would probably have been to rewrite everything to be more readable, past Aofei made a poor choice to simply add a function to parallelize the analysis of all channels and export the data to be postprocessed in python scripts, since 'nobody else would ever read the code anyway'. Since not all of the channels would necessarily return good quality signal, there had to be some filtering done on the output after exporting all the channels. While it would probably be better practice to not set a bunch of hard-coded variables for these filters (and probably use percentile thresholds like in my histology segmentation analysis code), these have been left in to reflect what was actually used to analyze the particular set of data collected, and to reflect the unfortunate reality of the popularity of hard coded variables in scientific coding...
